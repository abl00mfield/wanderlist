<%- include("../partials/_navbar.ejs") %>

<div class="group-page-container">
  <h2>Group: <%= group.name %></h2>

  <% if (user && group.owner._id.toString() === user._id) { %>
  <div class="group-owner-actions">
    <a href="/groups/<%= group._id %>/edit">Edit Group</a>
    <form action="/groups/<%= group._id %>?_method=DELETE" method="POST">
      <button type="submit">Delete Group</button>
    </form>


  </div>

  <%}%>
  <h3>Members</h3>
  <ul>
    <% group.members.forEach(member => { %>
  <li>
    <%= member.username %>

  </li>
  <% }) %>
  </ul>



  <% if (user && group.owner._id.toString() !== user._id && group.members.some(member=> member._id.toString() === user._id)) { %>
  <form action="/groups/<%= group._id %>/leave?_method=PATCH" method="POST">
    <button type="submit">Leave Group</button>
  </form>
  <% } %>

  <h3>Group Destinations</h3>
  <% if (user && group.members.some(member => member._id.toString() === user._id)) { %>
  <% if (destinations.length > 0) { %>
  <ul class="group-destination-list">
    <% destinations.forEach(destination => { %>
    <a href="/destinations/<%= destination._id %>">
      <li>
        <%= destination.location %>
        <p><%= destination.notes %></p>
        <% if (destination.photos.length > 0) { %>
        <img src="<%= destination.photos[0].url %>" alt="<%= destination.photos[0].alt %>" width=250>
        <% } %>
      </li>
    </a>
    <% }) %>
  </ul>

  <% } else { %>
  <p>No destinations have been shared by Group Members</p>
  <% } %>

  <%} else { %>
  <p>You must be a member of this group to view its destinations.</p>
  <form action="/groups/<%= group._id %>/join?_method=PATCH" method="POST">
    <button type="submit">Join Group</button>
  </form>
  <% } %>


</div>